\newpage
\begin{center}
  \textbf{\large 3. ДПостроение преобразователей угол-код на синусно-косинусных решающих устройствах}
\end{center}
\refstepcounter{chapter}
\addcontentsline{toc}{chapter}{3. Построение преобразователей угол-код на синусно-косинусных решающих устройствах}


\section{Классические схемы и их эволюция}


В литературе, \textbf{ссылка на Вульвета}, описаны различные методы построения преобразователей угол-код. 
Среди цифровых кодирующих преобразователей угловых перемещений существует два осноных класса: 
\begin{itemize}
  \item Преобразователи абсолютных значений
  \item Накапливающие преобразователи 
\end{itemize}

К первой группе относятся:
\begin{itemize}
  \item Контактные кодирующие преобразователи 
  \item Магнитные устройства кодирования
  \item Оптические кодирующие устройства
     % \item Аналоговые схемы с использованием \textbf{RLC-цепей} для формирования сигналов.
    % \item Трансформаторные системы, основанные на взаимной индукции.
    % \item Дифференциальные усилители с компенсацией фазовых искажений.
    % \item Многоканальные устройства с разделением сигналов по частоте.
\end{itemize}

Однако такие решения обладают существенными недостатками в современных условиях:
\begin{itemize}
  \item \textbf{Считывание}: Использование моточных изделий (трансформаторов, катушек) увеличивает массу и габариты устройств.
    % \item \textbf{Устаревание элементной базы}: Использование моточных изделий (трансформаторов, катушек) увеличивает массу и габариты устройств.
    % \item \textbf{Сложность настройки}: Требуется точная подстройка аналоговых компонентов, что снижает надежность.
    % \item \textbf{Низкая совместимость} с цифровыми системами управления.
\end{itemize}

Развитие микропроцессорной техники и миниатюризация контроллеров привели к переходу на компактные и энергоэффективные решения. 
Современные преобразователи исключают громоздкие аналоговые компоненты, заменяя их программируемыми схемами.

\section{Современные подходы}
В контексте оптимизации веса, габаритов и точности рассматриваются два типа схем:

\begin{enumerate}
    \item \textbf{Цифровые преобразователи на базе микроконтроллеров}:
    \begin{itemize}
        \item Используют АЦП и алгоритмы цифровой обработки сигналов (ЦОС).
        \item Лишены моточных элементов, что снижает массу на 30–40\%.
        \item Обеспечивают точность до \(\pm0.1^\circ\) за счет программной компенсации погрешностей.
    \end{itemize}
    
    \item \textbf{Гибридные схемы с интегрированными ИС}: \textbf{Указать тут миландр}
    \begin{itemize}
        \item Комбинируют аналоговые синусно-косинусные генераторы и цифровые интерфейсы (SPI, I\(^2\)C).
        \item Применяют специализированные микросхемы (например, AD2S1210), минимизирующие число внешних компонентов.
        \item Поддерживают разрешение до 16 бит при компактных размерах.
    \end{itemize}
\end{enumerate}

\subsection{Преимущества современных решений}
\begin{itemize}
    \item \textbf{Миниатюризация}: Отказ от трансформаторов снижает объем устройства в 2–3 раза.
    \item \textbf{Повышенная надежность}: Цифровая обработка исключает дрейф параметров аналоговых компонентов.
    \item \textbf{Совместимость}: Интеграция с промышленными сетями (CAN, Ethernet) упрощает внедрение.
\end{itemize}

Таким образом, классические схемы, описанные в ранних работах, уступают современным цифровым и гибридным решениям по ключевым параметрам. 
Переход на микроконтроллерные системы и специализированные ИС позволяет достичь высокой точности при минимальных массогабаритных показателях, 
что особенно актуально для аэрокосмических и робототехнических применений



\section{Техническое задание на устройство}

Было принято решение о собственной разработке печатного узла на базе stm32F7.


\subsection{НАЗНАЧЕНИЕ И СОСТАВ ИЗДЕЛИЯ}

Блок аналого-цифрового преобразователя вращающегося трансформатора (далее АЦПВТ, блок АЦПВТ, изделие) предназначен для определения углового положения одной из координат антенной системы. 
Работа АЦПВТ ведется по двухотсчетной схеме с величиной редукции от датчика грубого отсчета к датчику точного отсчета 1/36.  

\textbf{ОСНОВНЫЕ ТЕХНИЧЕСКИЕ ТРЕБОВАНИЯ}

\begin{itemize}
    \item На рисунке ~\ref{FuncBlocks}, упрощенно показана структурная схема изделия. 
          С помощью разъема СНП-59 блок подключается к датчикам углового положения и концевым выключателям приборного редуктора. 
          Внутри блока расположены схемы обработки сигналов вращающихся трансформаторов и концевых выключателей. 
          Преобразованные с помощью данных схем сигналы затем отправляются с помощью микроконтроллера и приемо-передатчика ведущему устройству.  

    \item Дополнительно в изделии установлен разъем 2РМГ24, подключенный параллельно концевым выключателям приборного редуктора с целью реализации цепей безопасности, 
          например подключение невозвратных концевых выключателей последовательно в цепь питания главного контактора шкафа электропривода. 

        \begin{figure}[!t]
          \centering
          \includegraphics[width=150mm ]{FuncBlocks.jpg} 
          \caption{Эскиз функциональных блоков изделия}
          \label{FuncBlocks}
        \end{figure}

    \item Изделие должно функционировать с вращающимися трансформаторами типа ЛИР-ДР158А.
      \end{itemize}


    В качестве интерфейса информационного обмена должен использоваться последовательный SSI со следующими параметрами:
    \begin{itemize}
          \item частота следования импульсов сигнала «Clock» 100кГц,
          \item  формирование телеграммы блока АЦПВТ должно происходить при использовании кода Грея. 
    \end{itemize}
    В телеграмме 18 бит, начиная со старшего (MSB), должны быть использованы для передачи углового положения координаты антенны. 

    На этапе программирования должна быть осуществлена стыковка с модулем подключения энкодеров SMC30 преобразователя частоты Sinamics S-120 и проверка совместного функционирования. 

\textbf{КОНСТРУКТИВНЫЕ ТРЕБОВАНИЯ}
        Конструктивно блок АЦПВТ должен представлять из себя картридж, который вставляется в корпус приборного редуктора. 
        После стыковки блока АЦПВТ и приборного редуктора обеспечивается герметичность узла. 

        Cхема блока размещена на одной печатной плате, габариты которой задаются эскизом корпуса блока АЦПВТ (см. рисунки \ref{Corp1}, \ref{Corp2}). 

        \begin{figure}[!t]
          \centering
          \includegraphics[width=150mm ]{Corp1.jpg} 
          \caption{Корпус блока}
          \label{Corp1}
        \end{figure}

        \begin{figure}[!t]
          \centering
          \includegraphics[width=150mm ]{Corp2.jpg} 
          \caption{Корпус блока}
          \label{Corp2}
        \end{figure}

  \textbf{ТРЕБОВАНИЯ УСТОЙЧИВОСТИ К ВНЕШНИМ ВОЗДЕЙСТВИЯМ}
  Требования по стойкости к воздействию климатических факторов:
\begin{itemize}

  \item пониженная температура рабочая – минус 40°С;

  \item пониженная температура предельная – минус 60°С;

 \item повышенная температура рабочая – плюс 60°С;

 \item повышенная температура предельная – плюс 70°С;

 \item относительная влажность – до 95 процентов при температуре плюс 30°С;

 \item иней и роса – температура минус 25°С, длительность воздействия до 2 часов;

 \item соляной туман в циклическом режиме.

\end{itemize}


\section{Узел печатный}

По итогам проведёного НИР был изготовлен узел печатный блока АЦПВТ. Для создания возбуждающего синусоидального сигнала был выбран внешний ЦАП, подключенный к целому порту. 
Для обработки сигналов двух датчиков установлены внешние АЦП, на каждый их них также выделено по целому порту для удобства использования. Для синхронизации была реализована схема 
работы аппаратных таймеров в режиме взаимодействия ведущий - ведомый. (см. рис. ~\ref{Timers})


\begin{figure}[!h]
  \centering
  \includegraphics[width=150mm ]{TimersScheme1.png} 
  \caption{Схема взаимодействия таймеров}
  \label{Timers}
\end{figure}

Мастер-таймер 4 синхронно запускает таймеры 3 и 9. Таймер 3 запускает DMA (Direct Memory Access - переферия для доступа в память без участия процессора) на передачу нового значения в порт ЦАП.
После передачу он в режиме one-pulse-mode подает сигнал (Write Gen) на пин микросхемы, начиная загрузку значения из параллельного порта во внутренний регистр ЦАП. Таймер 9 нужен для задержки подачи
сигнала начала преобразования АЦП (Conversion start), чтобы делать выборку по амплитуде сигнала с датчика ЛИР-ДР158А, увеличивая тем самым точность расчетов.

Взятие данных с параллельного порта АЦП происходит также посредствам DMA в момент получения прерывания по спадающему фронта сигнала Busy. Так как этот сигнал через логические "ИЛИ" 
заведен на все 4 микросхемы АЦП, то значения снимаются со всех АЦП после окончания преобразования последнего. 
\textbf{схемы включения АЦП и ЦАП}

\textbf{Картинка синуса с ЦАП}

\section{Разработка следящего алгоритма}

В рамках разработки системы обработки сигналов датчиков угловых перемещений ЛИР-ДР158А был выбран метод следящего преобразования. Данный метод, 
описанный в статье \cite{Anufriev2014}, позволяет минимизировать систематические ошибки и повысить разрешающую способность преобразователя. Е
го ключевая идея заключается в использовании контура обратной связи, компенсирующего фазовые и скоростные рассогласования.

\subsection{Принцип работы следящего алгоритма}
Структурная схема следящего преобразователя представлена на схеме рис. \ref{fig:tracking_scheme}. 

\begin{figure}[ht]
  \resizebox{150mm}{!}{%
  \begin{tikzpicture}[
      block/.style={
          rectangle, 
          draw, 
          text width=6em, 
          text centered, 
          minimum height=3em, 
          font=\small,
          rounded corners=3pt
      },
      arrow/.style={->, thick, >=stealth},
      node distance=1.2cm and 0.8cm,
    ]
  
  % Блоки
  \node[block] (multSin) {Умножитель на $\sin(\phi')$};
  \node[block, below=of multSin] (multCos) {Умножитель на $\cos(\phi')$};
  \node[block, right=of multSin] (detector) {Детектор ошибки};
  \node[block, right=of detector] (integrator) {Интегратор угла};
  
  % Сигналы
  \node[left=of multSin] (inputSin) {$ V sin(\omega t) sin(\phi)$};
  \node[left=of multCos] (inputCos) {$ V sin(\omega t) cos(\phi)$};
  \node[right=of integrator] (output) {$\omega$};
  
  % Обратная связь: phi' к умножителям
  \coordinate (feedback) at ($(integrator.east)!0.5!(output.west)$);
  \node[above=0.3cm of feedback, font=\scriptsize] {};
  \draw[arrow, dashed, red] (integrator.north) -- ++(0.5cm,0) |- ([yshift=1cm]multSin.north) -- (multSin.north);
  \draw[arrow, dashed, red] (integrator.south) -- ++(0.5cm,0) |- (multCos.east); %([yshift=1cm]multCos.south) -- 
  
  % Основные соединения
  \draw[arrow] (inputSin) -- (multSin);
  \draw[arrow] (inputCos) -- (multCos);
  \draw[arrow] (multSin) -- (detector);
  \draw[arrow] (multCos) -- (detector);
  \draw[arrow] (detector) -- node[below=0.7cm] {} (integrator);
  \draw[arrow] (integrator) -- (output);
  
  % Пояснение обратной связи
  \node[above=0.1cm of multSin, align=center, font=\scriptsize] {};
  \node[below=0.1cm of multCos, align=center, font=\scriptsize] {Обратная связь: \\ $\phi'$ обновляется \\ через интегратор};
  
  \end{tikzpicture}
  } % Конец resizebox
  \caption{Схема следящего преобразователя с обратной связью.} % Красные пунктирные линии показывают передачу оценки угла $\phi'$ обратно в умножители.
  \label{fig:tracking_scheme}
  
  \end{figure}
  

Алгоритм включает следующие этапы:
\begin{enumerate}
    \item \textbf{Умножение сигналов:} Входные сигналы \( V_{\text{sin}} \) и \( V_{\text{cos}} \) умножаются на синтезированные опорные сигналы \( \sin(\phi') \) и \( \cos(\phi') \), где \( \phi' \) — текущая оценка угла. 
    \item \textbf{Детектирование ошибки:} Результирующий сигнал ошибки формируется как: 
    \begin{equation}
      e = V sin(\omega t) sin(\phi) \cdot cos(\phi') - V sin(\omega t) cos(\phi) \cdot sin(\phi') = V sin(\omega t) \cdot \sin(\phi - \phi'),
      \label{eq:error}
    \end{equation}
    % \[
    % e = V sin(\omega t) sin(\phi) \cdot cos(\phi') - V sin(\omega t) cos(\phi) \cdot sin(\phi') = V sin(\omega t) \cdot \sin(\phi - \phi') .
    % \]
    Для малых рассогласований \( \phi - \phi' \) ошибка пропорциональна разности углов ($\sin(\phi - \phi') \approx \phi - \phi'$).
    \item \textbf{Интегрирование:} Сигнал ошибки интегрируется для расчёта угловой скорости \( \omega \), а затем — угла \( \phi' \). 
    \begin{equation}
      \phi'(t) = K_i \int_0^t \sin\left(\phi(\tau) - \phi'(\tau)\right) d\tau,
      \label{eq:phi_prime}
    \end{equation}
      
      где:
    \begin{itemize}
        \item \(K_i\) — коэффициент усиления интегратора,
        \item \(\phi(\tau)\) — истинный угол (измеряемый датчиком),
        \item \(\phi'(0)\) — начальное условие (оценка угла в момент \(t=0\)).
    \end{itemize}


    Интегратор устраняет постоянную составляющую ошибки, обеспечивая нулевую погрешность при постоянной скорости вращения.
\end{enumerate}

\subsection{Преимущества и ограничения}
Метод следящего преобразования обладает следующими преимуществами:
\begin{itemize}
    \item Компенсация систематических ошибок при постоянной скорости вращения.
    \item Высокая разрешающая способность (до 19 бит для двухотсчётных систем).
    \item Фильтрация помех в контуре обратной связи, что повышает отношение сигнал/шум.
\end{itemize}

Однако алгоритм имеет ограничения:
\begin{itemize}
    \item Чувствительность к неоднородности параметров обмоток СКВТ.
    \item Ошибки при ускорении датчика, связанные с ограниченной полосой пропускания контура \cite{Anufriev2014}.
\end{itemize}

\subsection{Реализация в печатной плате}
Разработанный алгоритм интегрирует следящий алгоритм.

\subsection{Заключение}
Следящий алгоритм демонстрирует высокую эффективность при обработке сигналов СКВТ и сельсинов. 

\section{Испытательный стенд}

Для проведения испытаний бы изготовлен стенд c двумя датчиками ЛИР-ДР158А с передаточным отношением 1/36. 
С помощью специально подготовленного переходника, блок АЦПВТ был подключен к установке. \textbf{Вставить фото подключенного стенда к АЦПВТ}
Сигналы с датчика стали поступать на АЦП \textbf{картинка кинсуов с датчика}